{% extends 'base.html' %}

{% block content %}
<div id="checkInContainer" data-lang="{{ session['lang'] }}">
    <div class="subtitle text-center">
        {% if session['lang'] == "sw" %}
            Tathmini ya Awali
        {% else %}
            Early Check-in
        {% endif %}
    </div>
    <form action="{{url_for('check_in')}}" method="post" id="checkInForm">
        {% if not current_user.is_authenticated %}
            <div class="mt-3">
                <label for="age" class="form-label subtext">
                    {% if session['lang'] == "sw" %}
                        Ingiza umri wako:
                    {% else %}
                        Enter your age:
                    {% endif %}
                </label>
                <input type="number" class="custom-form-control" name="age" id="age" placeholder="" required min="13" max="99">
                <div id="age-error" class="text-danger" style="display: none;">
                    {% if session['lang'] == "sw" %}
                        Umri haupaswi kuwa chini ya 13 au zaidi ya 99.
                    {% else %}
                        Age should not be less than 13 or more than 99.
                    {% endif %}
                </div>
            </div>
            <div class="mt-3">
                <label for="gender" class="form-label subtext">
                    {% if session['lang'] == "sw" %}
                        Chagua jinsia yako:
                    {% else %}
                        Select your gender:
                    {% endif %}
                </label>
                <select name="gender" id="gender" class="custom-form-select" required>
                    <option value="" disabled selected>
                        {% if session['lang'] == "sw" %}
                            -- Chagua Jinsia --
                        {% else %}
                            -- Select Gender --
                        {% endif %}
                    </option>
                    <option value="female">
                        {% if session['lang'] == "sw" %}
                            Mwanamke
                        {% else %}
                            Female
                        {% endif %}
                    </option>
                    <option value="male">
                        {% if session['lang'] == "sw" %}
                            Mwanaume
                        {% else %}
                            Male
                        {% endif %}
                    </option>
                </select>
            </div>
        {% endif %}
        <div class="my-4 text">
            {% for item in items %}
                <div class="mb-4">
                    <strong>
                        {% if session['lang'] == "sw" %}
                            {{ item.title_sw }}:
                        {% else %}
                            {{ item.title }}:
                        {% endif %}
                    </strong>
                    {% for opt in item.options %}
                        <div class="form-check mt-3">
                            <input class="form-check-input" type="checkbox" value="{{opt.text}}" name="symptoms" data-category="{{ item.id }}" id="{{item.id}}-{{opt.id}}">
                            <label class="form-check-label ms-2" for="{{item.id}}-{{opt.id}}">
                                {% if session['lang'] == "sw" %}
                                    {{ opt.text_sw }}
                                {% else %}
                                    {{ opt.text }}
                                {% endif %}
                            </label>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
        <div id="alert" class="alert alert-success p-2 mb-3"></div>
        <div class="mb-3 text-center">
            <button type="submit" class="custom-btn px-4 text" id="checkButton">
                <span id="spinnerContainer" style="display: none;">
                    <span class="spinner-border spinner-border-sm"></span>
                </span>
                <span id="buttonText">
                    {% if session['lang'] == "sw" %}
                        Tathmini
                    {% else %}
                        Check
                    {% endif %}
                </span>
            </button>
            
        </div>
        
    </form>
    <div id="predictedCondition" class="mb-3"></div>
    <div class="mb-3 border-green text rounded-5" id="results">
        <div id="resultsContent"></div>
        <div id="resultsLink"></div>
    </div>
</div>

<script>
    document.getElementById("checkInForm").addEventListener("submit", function (event) {
        var age = document.getElementById("age").value;
        var gender = document.getElementById("gender").value;
        var ageError = document.getElementById("age-error");

        // Reset error messages
        ageError.style.display = "none";

        // Perform additional client-side validation if needed

        // Check if age is provided and within a valid range
        if (!age || isNaN(age) || !(13 <= parseInt(age) && parseInt(age) <= 99)) {
            ageError.style.display = "block";
            event.preventDefault();  // Prevent form submission
        }

        // Check if gender is provided
        if (!gender) {
            alert("Gender is required.");  // You can replace this with a better way of displaying errors
            event.preventDefault();  // Prevent form submission
        }

        // Add other client-side validations as needed
    });
</script>


{% endblock content %}
