{% extends 'base.html' %}



{% block content %}
<div class="subtitle text-center">
    {% if session['lang'] == "sw" %}
        Jisajili
    {% else %}
        Registration
    {% endif %}
</div>
<div class="mb-3">
    <small style="font-weight: bold; color: white;">
        {% if session['lang'] == "sw" %}
            <strong>Usiogope:</strong>
            Hatukusanyi taarifa binafsi. 
            Tafadhali tumia jina lisilo kutambulisha ila la kipekee na nenosiri imara
        {% else %}
            <strong>Disclaimer:</strong>
            We do not collect any personal information. Use a non-identifying but 
            unique username and a strong password
        {% endif %}
    </small>
</div>


<div>
    {% for msg in get_flashed_messages() %}
        <div class="text-danger my-2 text-center">
            {{msg}}        
        </div>
    {% endfor %}
    <div class="login-box">
    <form method="post" action="{{url_for('register')}}">
        <div class="mb-3">
            <label for="username" class="form-label subtext">
                {% if session['lang'] == "sw" %}
                    Jina la mtumiaji
                {% else %}
                    Username
                {% endif %}
            </label>
            <input type="text" name="username" id="username" class="custom-form-control" placeholder="{% if session['lang'] == 'sw' %}Jina la mtumiaji{% else %}Username{% endif %}" required>


        </div>
        <div class="mb-3">
            <label for="age" class="form-label subtext">
                {% if session['lang'] == "sw" %}
                    Ingiza umri wako:
                {% else %}
                    Enter your age:
                {% endif %}
            </label>
            <input type="text" class="custom-form-control" name="age" id="age" inputmode="numeric" placeholder="" required>
        </div>
        <div class="mb-3">
            <label for="gender" class="form-label subtext">
                {% if session['lang'] == "sw" %}
                    Chagua jinsia yako:
                {% else %}
                    Select your gender:
                {% endif %}
            </label>
            <select name="gender" id="gender" class="custom-form-select" required>
                <option value="" selected>
                    {% if session['lang'] == "sw" %}
                        Mwanamke
                    {% else %}
                        Female
                    {% endif %}
                </option>
                <option value="Male">
                    {% if session['lang'] == "sw" %}
                        Mwanaume
                    {% else %}
                        Male
                    {% endif %}
                </option>
            </select>
        </div>
    <!-- Password field with toggle icon -->
<div class="mb-3 password-wrapper">
    <label for="password" class="form-label subtext">
        {% if session['lang'] == "sw" %}Nenosiri{% else %}Password{% endif %}
    </label>
    <input type="password" name="password" id="password" class="custom-form-control" placeholder="{% if session['lang'] == 'sw' %}nenosiri{% else %}Password{% endif %}" minlength="6" maxlength="128" required>
    <i class="fas fa-eye password-icon" onclick="togglePasswordVisibility('password', this)"></i>
</div>

<!-- Confirm Password field with toggle icon -->
<div class="mb-3 password-wrapper">
    <label for="confirm_password" class="form-label subtext">
        {% if session['lang'] == "sw" %}Thibitisha Nenosiri{% else %}Confirm Password{% endif %}
    </label>
    <input type="password" name="confirm_password" id="confirm_password" class="custom-form-control" placeholder="{% if session['lang'] == 'sw' %}thibitisha nenosiri{% else %}Confirm Password{% endif %}" minlength="6" maxlength="128" required>
    <i class="fas fa-eye password-icon" onclick="togglePasswordVisibility('confirm_password', this)"></i>
</div>


    <div class="mb-3">

          
        </label>
        
        
    </div>
        <div class="mb-3">
            {% if session["lang"] == "sw" %}
                Jibu maswali yafuatayo. Maswali haya yatatumika kurejesha nenosiri lako
                iwapo utalipoteza.
            {% else %}
                Answer the following questions. These questions will be used to recover your password
                incase you loose it.
            {% endif %}
        </div>
        {% for qn in qns %}
            <div class="mb-3">
                <label for="qn{{qn.id}}" class="form-label subtext">
                    {% if session["lang"] == "sw" %}
                        {{qn.text_sw}}
                    {% else %}
                        {{qn.text}}
                    {% endif %}
                </label>
                <input type="text" name="qn-{{qn.id}}" id="qn{{qn.id}}" class="custom-form-control" placeholder="answer" required>
            </div>
        {% endfor %}
        <div class="mb-3 text-center">
            <input 
                type="submit" 
                value="{% if session['lang'] == 'sw' %}Jisajili{% else %}Register{% endif %}" 
                class="custom-btn px-4 text">
        </div>
    </form>

</div>
</div>



<script>
    document.addEventListener('DOMContentLoaded', function () {
        var form = document.querySelector('form');
        form.onsubmit = function () {
            // Password validation
            var password = document.getElementById('password').value;
            var confirm_password = document.getElementById('confirm_password').value;
            var passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}$/;

            if (!passwordRegex.test(password)) {
                alert("{% if session['lang'] == 'sw' %}Nenosiri lazima liwe na urefu wa angalau herufi 6, na liwe na mchanganyiko wa herufi kubwa, herufi ndogo, na nambari.{% else %}Password must be at least 6 characters long, and include a mix of upper and lower case letters, and numbers.{% endif %}");
                return false; // Prevent form submission
            }

            if (password !== confirm_password) {
                alert("{% if session['lang'] == 'sw' %}Nenosiri na uthibitisho wa nenosiri lazima ziwe sawa.{% else %}Password and confirmation password must match.{% endif %}");
                return false; // Prevent form submission
            }

            // If we get here, everything is fine
            return true; // Allow form submission
        };
    });
    function togglePasswordVisibility(fieldId, icon) {
        var field = document.getElementById(fieldId);
        if (field.type === "password") {
            field.type = "text";
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            field.type = "password";
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }
</script>



{% endblock content %}

{% set curr_page="register" %}